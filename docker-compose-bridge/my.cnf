[mysqld]
# Geral
bind-address = 0.0.0.0
character-set-server = utf8mb4
collation-server = utf8mb4_bin
default-time-zone = 'America/Sao_Paulo'

# Logs
log_error = /var/log/mysql/error.log
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2

# InnoDB
innodb_buffer_pool_size = 2G           # 50-70% da memória total do host
innodb_log_file_size = 512M            # Tamanho do log para suportar grandes transações
innodb_flush_log_at_trx_commit = 2     # Melhor desempenho, aceitando pequeno risco de perda em crash
innodb_io_capacity = 100               # Capacidade IOPS para discos SSD
innodb_flush_method = O_DIRECT         # Evitar duplo cache (sistema e InnoDB)
innodb_buffer_pool_instances = 16      # Dividir o buffer pool em múltiplas instâncias
innodb_log_buffer_size = 256M          # Buffer de log para reduzir escritas frequentes

# Conexões e Threads
max_connections = 2000                 # Suportar grande número de conexões simultâneas
thread_cache_size = 100                # Cache de threads para reduzir criação/destruição frequente
max_allowed_packet = 64M               # Suportar grandes queries ou transações
table_open_cache = 4000                # Cache de tabelas abertas para reduzir I/O

# Otimizações de Cache e Queries
query_cache_type = 0                   # Desabilitar query cache para evitar contenção em sistemas modernos
query_cache_size = 0
tmp_table_size = 512M                  # Suportar grandes tabelas temporárias em memória
max_heap_table_size = 512M             # Ajustar para tabelas temporárias em memória
join_buffer_size = 8M                  # Buffer para operações JOIN
sort_buffer_size = 8M                  # Buffer para ordenações
read_buffer_size = 4M                  # Buffer para leituras sequenciais
read_rnd_buffer_size = 16M             # Buffer para leituras randômicas

# Rede
net_buffer_length = 16K                # Buffer para pacotes de rede
max_allowed_packet = 64M               # Tamanho máximo permitido para um pacote de dados
interactive_timeout = 3600             # Tempo limite para conexões interativas
wait_timeout = 3600                    # Tempo limite para outras conexões

# Backup e Replicação
server-id = 1                          # Identificador único para replicação
log_bin = /var/log/mysql/mysql-bin.log # Habilitar logs binários para replicação
binlog_format = ROW                    # Binlog no formato ROW para maior precisão
expire_logs_days = 7                   # Retenção de 7 dias de logs binários
sync_binlog = 1                        # Garantir consistência em replicações críticas

# Monitoramento e Estatísticas
performance_schema = 1                 # Habilitar schema de performance para análise
innodb_monitor_enable = all            # Ativar monitoramento avançado do InnoDB
